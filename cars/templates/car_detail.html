{% extends 'base.html' %}
{% load static %}

{% block title %}{{ car.brand.name }} {{ car.model }} {{ car.model_year }} - NewCars{% endblock %}

{% block meta_description %}{{ car.brand.name }} {{ car.model }} {{ car.model_year }}, {{ car.color }}, {{ car.mileage|floatformat:0 }} km. Apenas R$ {{ car.price }}. Confira!{% endblock %}

{% block extra_css %}
<style>
    /* ===== Estilos específicos da página de detalhes ===== */
    .detail-header {
        background: var(--gradient-dark);
        padding: 8rem 2rem 3rem;
        margin-top: 70px;
        color: var(--white);
    }

    .detail-header-content {
        max-width: 1200px;
        margin: 0 auto;
    }

    .breadcrumb {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 1rem;
        font-size: 0.9rem;
        color: var(--gray-light);
    }

    .breadcrumb a {
        color: var(--gray-light);
        text-decoration: none;
        transition: var(--transition-fast);
    }

    .breadcrumb a:hover {
        color: var(--white);
    }

    .breadcrumb span {
        color: var(--accent-color);
    }

    .detail-title {
        font-size: 2.5rem;
        margin-bottom: 0.5rem;
        animation: fadeInUp 0.8s ease;
    }

    .detail-subtitle {
        font-size: 1.2rem;
        color: var(--gray-light);
        display: flex;
        align-items: center;
        gap: 1rem;
        flex-wrap: wrap;
        animation: fadeInUp 0.8s ease 0.2s both;
    }

    .detail-subtitle .badge {
        background: var(--gradient-primary);
        padding: 0.3rem 1rem;
        border-radius: 20px;
        font-size: 0.9rem;
        font-weight: 600;
    }

    .detail-container {
        max-width: 1200px;
        margin: -2rem auto 4rem;
        padding: 0 2rem;
        position: relative;
        z-index: 10;
    }

    .detail-grid {
        display: grid;
        grid-template-columns: 1fr 400px;
        gap: 2rem;
        margin-bottom: 3rem;
    }

    /* ===== Galeria de Imagens ===== */
    .car-gallery {
        background: var(--white);
        border-radius: 16px;
        overflow: hidden;
        box-shadow: var(--shadow-lg);
        animation: fadeIn 0.8s ease;
    }

    .main-image {
        width: 100%;
        height: 600px;
        background: linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        overflow: hidden;
        cursor: zoom-in;
    }

    .main-image img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        transition: var(--transition-normal);
        padding: 1rem;
    }

    .main-image:hover img {
        transform: scale(1.08);
    }
    
    .main-image.zoomed {
        cursor: zoom-out;
    }
    
    .main-image.zoomed img {
        transform: scale(1.5);
        object-fit: cover;
        padding: 0;
    }

    .main-image .no-image {
        font-size: 5rem;
        color: var(--gray);
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 1rem;
    }
    
    .main-image .no-image p {
        font-size: 1rem;
        color: var(--gray);
    }
    
    .image-quality-badge {
        position: absolute;
        top: 1rem;
        left: 1rem;
        background: rgba(0,0,0,0.7);
        backdrop-filter: blur(10px);
        padding: 0.4rem 0.8rem;
        border-radius: 6px;
        color: var(--white);
        font-size: 0.75rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 0.3rem;
    }
    
    .image-quality-badge i {
        color: var(--accent-color);
    }

    .image-overlay {
        position: absolute;
        top: 1rem;
        right: 1rem;
        display: flex;
        gap: 0.5rem;
    }

    .image-overlay .badge-overlay {
        background: rgba(0,0,0,0.7);
        backdrop-filter: blur(10px);
        padding: 0.5rem 1rem;
        border-radius: 8px;
        color: var(--white);
        font-weight: 600;
        font-size: 0.9rem;
    }

    .image-overlay .badge-available {
        background: rgba(46, 213, 115, 0.9);
    }

    .image-overlay .badge-sold {
        background: rgba(239, 68, 68, 0.9);
    }
    
    .image-actions {
        position: absolute;
        bottom: 1rem;
        right: 1rem;
        display: flex;
        gap: 0.5rem;
    }
    
    .image-action-btn {
        width: 44px;
        height: 44px;
        background: rgba(0,0,0,0.7);
        backdrop-filter: blur(10px);
        border: none;
        border-radius: 50%;
        color: var(--white);
        font-size: 1.1rem;
        cursor: pointer;
        transition: var(--transition-fast);
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .image-action-btn:hover {
        background: var(--primary-color);
        transform: translateY(-3px);
        box-shadow: var(--shadow-md);
    }
    
    .image-action-btn:active {
        transform: translateY(0);
    }
    
    /* Lightbox Modal */
    .lightbox-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.95);
        z-index: 9999;
        align-items: center;
        justify-content: center;
        animation: fadeIn 0.3s ease;
    }
    
    .lightbox-modal.active {
        display: flex;
    }
    
    .lightbox-content {
        max-width: 90vw;
        max-height: 90vh;
        position: relative;
    }
    
    .lightbox-image {
        max-width: 100%;
        max-height: 90vh;
        object-fit: contain;
        border-radius: 8px;
        box-shadow: 0 0 40px rgba(255,255,255,0.1);
    }
    
    .lightbox-close {
        position: absolute;
        top: -50px;
        right: 0;
        width: 44px;
        height: 44px;
        background: rgba(255,255,255,0.1);
        border: 2px solid var(--white);
        border-radius: 50%;
        color: var(--white);
        font-size: 1.5rem;
        cursor: pointer;
        transition: var(--transition-fast);
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .lightbox-close:hover {
        background: var(--primary-color);
        border-color: var(--primary-color);
        transform: rotate(90deg);
    }
    
    .lightbox-caption {
        position: absolute;
        bottom: -50px;
        left: 0;
        right: 0;
        text-align: center;
        color: var(--white);
        font-size: 1.1rem;
    }

    /* ===== Card de Informações ===== */
    .car-info-card {
        background: var(--white);
        border-radius: 16px;
        padding: 2rem;
        box-shadow: var(--shadow-lg);
        position: sticky;
        top: 100px;
        animation: fadeInRight 0.8s ease;
    }

    .price-section {
        margin-bottom: 2rem;
        padding-bottom: 2rem;
        border-bottom: 2px solid var(--gray-light);
    }

    .price-label {
        font-size: 0.9rem;
        color: var(--gray);
        margin-bottom: 0.5rem;
    }

    .price-value {
        font-size: 2.5rem;
        font-weight: bold;
        color: var(--primary-color);
        display: flex;
        align-items: baseline;
        gap: 0.5rem;
    }

    .price-value small {
        font-size: 1rem;
        color: var(--gray);
        font-weight: normal;
    }

    .installment-info {
        margin-top: 0.5rem;
        font-size: 0.9rem;
        color: var(--gray);
    }

    .installment-info strong {
        color: var(--secondary-color);
    }

    /* ===== Especificações Rápidas ===== */
    .quick-specs {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
        margin-bottom: 2rem;
    }

    .spec-item {
        display: flex;
        flex-direction: column;
        gap: 0.3rem;
    }

    .spec-label {
        font-size: 0.8rem;
        color: var(--gray);
        display: flex;
        align-items: center;
        gap: 0.3rem;
    }

    .spec-label i {
        font-size: 0.9rem;
        color: var(--primary-color);
    }

    .spec-value {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--dark);
    }

    /* ===== Botões de Ação ===== */
    .action-buttons {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .btn-action {
        padding: 1rem;
        border: none;
        border-radius: 10px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition-fast);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        text-decoration: none;
        text-align: center;
    }

    .btn-action.primary {
        background: var(--gradient-primary);
        color: var(--white);
        box-shadow: var(--shadow-md);
    }

    .btn-action.primary:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
    }

    .btn-action.secondary {
        background: var(--secondary-color);
        color: var(--white);
    }

    .btn-action.secondary:hover {
        background: #003d6b;
        transform: translateY(-2px);
    }

    .btn-action.outline {
        background: transparent;
        border: 2px solid var(--dark);
        color: var(--dark);
    }

    .btn-action.outline:hover {
        background: var(--dark);
        color: var(--white);
    }

    /* ===== Detalhes Completos ===== */
    .details-section {
        background: var(--white);
        border-radius: 16px;
        padding: 2rem;
        box-shadow: var(--shadow-md);
        margin-bottom: 2rem;
        animation: fadeInUp 0.8s ease 0.4s both;
    }

    .section-title {
        font-size: 1.8rem;
        color: var(--dark);
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .section-title i {
        color: var(--primary-color);
    }

    .specs-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
    }

    .spec-detail {
        display: flex;
        align-items: flex-start;
        gap: 1rem;
        padding: 1rem;
        background: var(--light);
        border-radius: 10px;
        transition: var(--transition-fast);
    }

    .spec-detail:hover {
        transform: translateX(5px);
        background: var(--gray-light);
    }

    .spec-icon {
        font-size: 1.5rem;
        color: var(--primary-color);
        min-width: 30px;
    }

    .spec-content {
        flex: 1;
    }

    .spec-content strong {
        display: block;
        color: var(--dark);
        margin-bottom: 0.2rem;
        font-size: 0.9rem;
    }

    .spec-content span {
        color: var(--gray);
        font-size: 1.1rem;
    }

    /* ===== Descrição ===== */
    .description-section {
        background: var(--white);
        border-radius: 16px;
        padding: 2rem;
        box-shadow: var(--shadow-md);
        margin-bottom: 2rem;
        animation: fadeInUp 0.8s ease 0.5s both;
    }

    .description-text {
        color: var(--gray);
        line-height: 1.8;
        font-size: 1.05rem;
    }

    .description-text.empty {
        font-style: italic;
        text-align: center;
        padding: 2rem;
        color: var(--gray);
    }

    /* ===== Contato ===== */
    .contact-section {
        background: var(--gradient-dark);
        border-radius: 16px;
        padding: 3rem;
        color: var(--white);
        text-align: center;
        animation: fadeInUp 0.8s ease 0.6s both;
    }

    .contact-section h2 {
        font-size: 2rem;
        margin-bottom: 1rem;
    }

    .contact-section p {
        font-size: 1.1rem;
        color: var(--gray-light);
        margin-bottom: 2rem;
    }

    .contact-options {
        display: flex;
        justify-content: center;
        gap: 1rem;
        flex-wrap: wrap;
    }

    .contact-btn {
        padding: 1rem 2rem;
        border-radius: 10px;
        font-weight: 600;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        transition: var(--transition-fast);
    }

    .contact-btn.whatsapp {
        background: #25D366;
        color: var(--white);
    }

    .contact-btn.whatsapp:hover {
        background: #20ba5a;
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
    }

    .contact-btn.phone {
        background: var(--white);
        color: var(--dark);
    }

    .contact-btn.phone:hover {
        background: var(--gray-light);
        transform: translateY(-2px);
    }

    /* ===== Botões Administrativos ===== */
    .admin-actions {
        margin-top: 2rem;
        padding-top: 2rem;
        border-top: 2px solid var(--gray-light);
    }

    .admin-actions-title {
        font-size: 0.9rem;
        color: var(--gray);
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-weight: 600;
    }

    .admin-actions-title i {
        color: var(--primary-color);
    }

    .admin-buttons {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
    }

    .btn-action.edit {
        background: var(--primary-color);
        color: var(--white);
    }

    .btn-action.edit:hover {
        background: #0056b3;
        transform: translateY(-2px);
    }

    .btn-action.delete {
        background: #ef4444;
        color: var(--white);
    }

    .btn-action.delete:hover {
        background: #dc2626;
        transform: translateY(-2px);
    }

    /* ===== Modal de Confirmação ===== */
    .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(5px);
        z-index: 10000;
        align-items: center;
        justify-content: center;
        animation: fadeIn 0.3s ease;
    }

    .modal-overlay.active {
        display: flex;
    }

    .modal-content {
        background: var(--white);
        border-radius: 16px;
        padding: 2rem;
        max-width: 500px;
        width: 90%;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        animation: slideDown 0.3s ease;
        position: relative;
    }

    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-50px) scale(0.9);
        }
        to {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
    }

    .modal-header {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1.5rem;
    }

    .modal-icon {
        width: 60px;
        height: 60px;
        background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.8rem;
        color: #ef4444;
    }

    .modal-title {
        flex: 1;
    }

    .modal-title h3 {
        font-size: 1.5rem;
        color: var(--dark);
        margin: 0 0 0.3rem 0;
    }

    .modal-title p {
        font-size: 0.9rem;
        color: var(--gray);
        margin: 0;
    }

    .modal-body {
        background: var(--light);
        padding: 1.5rem;
        border-radius: 10px;
        margin-bottom: 1.5rem;
    }

    .modal-car-info {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    .modal-car-info strong {
        color: var(--dark);
        font-size: 1.1rem;
    }

    .modal-car-info p {
        color: var(--gray);
        margin: 0;
        font-size: 0.95rem;
    }

    .modal-warning {
        background: #fef3c7;
        border-left: 4px solid #f59e0b;
        padding: 1rem;
        border-radius: 8px;
        margin-top: 1rem;
        display: flex;
        align-items: start;
        gap: 0.8rem;
    }

    .modal-warning i {
        color: #f59e0b;
        font-size: 1.2rem;
        margin-top: 0.2rem;
    }

    .modal-warning p {
        margin: 0;
        font-size: 0.9rem;
        color: #92400e;
        line-height: 1.5;
    }

    .modal-actions {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
    }

    .modal-btn {
        padding: 0.9rem 1.5rem;
        border: none;
        border-radius: 10px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition-fast);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
    }

    .modal-btn.cancel {
        background: var(--gray-light);
        color: var(--dark);
    }

    .modal-btn.cancel:hover {
        background: var(--gray);
    }

    .modal-btn.confirm {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        color: var(--white);
        box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
    }

    .modal-btn.confirm:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
    }

    .modal-btn.confirm:active {
        transform: translateY(0);
    }

    /* ===== Animações ===== */
    @keyframes fadeIn {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes fadeInRight {
        from {
            opacity: 0;
            transform: translateX(30px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    /* ===== Responsividade ===== */
    @media (max-width: 992px) {
        .detail-grid {
            grid-template-columns: 1fr;
        }

        .car-info-card {
            position: relative;
            top: 0;
        }

        .detail-title {
            font-size: 2rem;
        }

        .main-image {
            height: 400px;
        }

        .specs-grid {
            grid-template-columns: 1fr;
        }
    }

    @media (max-width: 768px) {
        .detail-header {
            padding: 6rem 1rem 2rem;
        }

        .detail-title {
            font-size: 1.5rem;
        }

        .detail-subtitle {
            font-size: 1rem;
        }

        .price-value {
            font-size: 2rem;
        }

        .main-image {
            height: 350px;
        }
        
        .image-actions {
            bottom: 0.5rem;
            right: 0.5rem;
        }
        
        .image-action-btn {
            width: 40px;
            height: 40px;
            font-size: 1rem;
        }
        
        .lightbox-caption {
            font-size: 0.9rem;
            bottom: -40px;
        }

        .quick-specs {
            grid-template-columns: 1fr;
        }

        .contact-options {
            flex-direction: column;
        }

        .contact-btn {
            width: 100%;
            justify-content: center;
        }

        .admin-buttons {
            grid-template-columns: 1fr;
        }

        .modal-content {
            padding: 1.5rem;
        }

        .modal-title h3 {
            font-size: 1.2rem;
        }

        .modal-actions {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Header do Detalhe -->
<div class="detail-header">
    <div class="detail-header-content">
        <nav class="breadcrumb">
            <a href="{% url 'home' %}"><i class="fas fa-home"></i> Início</a>
            <span>/</span>
            <a href="{% url 'list_cars' %}">Catálogo</a>
            <span>/</span>
            <span>{{ car.brand.name }} {{ car.model }}</span>
        </nav>
        
        <h1 class="detail-title">{{ car.brand.name }} {{ car.model }}</h1>
        <div class="detail-subtitle">
            <span><i class="fas fa-calendar-alt"></i> {{ car.factory_year }}/{{ car.model_year }}</span>
            <span class="badge">
                {% if car.is_available %}
                    <i class="fas fa-check-circle"></i> Disponível
                {% else %}
                    <i class="fas fa-times-circle"></i> Vendido
                {% endif %}
            </span>
        </div>
    </div>
</div>

<!-- Container Principal -->
<div class="detail-container">
    <div class="detail-grid">
        <!-- Galeria de Imagens -->
        <div class="car-gallery">
            <div class="main-image" id="mainImage">
                {% if car.image %}
                    <img src="{{ car.image.url }}" alt="{{ car.brand.name }} {{ car.model }}" id="carImage">
                    
                    <!-- Badge de qualidade -->
                    <div class="image-quality-badge">
                        <i class="fas fa-camera"></i>
                        Foto Real
                    </div>
                {% else %}
                    <div class="no-image">
                        <i class="fas fa-car"></i>
                        <p>Imagem não disponível</p>
                    </div>
                {% endif %}
                
                <!-- Overlay de status -->
                <div class="image-overlay">
                    {% if car.is_available %}
                        <span class="badge-overlay badge-available">
                            <i class="fas fa-check"></i> Disponível
                        </span>
                    {% else %}
                        <span class="badge-overlay badge-sold">
                            <i class="fas fa-times"></i> Vendido
                        </span>
                    {% endif %}
                </div>
                
                <!-- Ações da imagem -->
                {% if car.image %}
                <div class="image-actions">
                    <button class="image-action-btn" id="zoomBtn" title="Ampliar imagem">
                        <i class="fas fa-search-plus"></i>
                    </button>
                    <button class="image-action-btn" id="fullscreenBtn" title="Ver em tela cheia">
                        <i class="fas fa-expand"></i>
                    </button>
                    <button class="image-action-btn" id="shareBtn" title="Compartilhar">
                        <i class="fas fa-share-alt"></i>
                    </button>
                </div>
                {% endif %}
            </div>
        </div>
        
        <!-- Modal Lightbox -->
        {% if car.image %}
        <div class="lightbox-modal" id="lightboxModal">
            <div class="lightbox-content">
                <button class="lightbox-close" id="closeLightbox">
                    <i class="fas fa-times"></i>
                </button>
                <img src="{{ car.image.url }}" alt="{{ car.brand.name }} {{ car.model }}" class="lightbox-image">
                <div class="lightbox-caption">
                    {{ car.brand.name }} {{ car.model }} - {{ car.factory_year }}/{{ car.model_year }}
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Card de Informações -->
        <div class="car-info-card">
            <!-- Preço -->
            <div class="price-section">
                <div class="price-label">Preço à vista</div>
                <div class="price-value">
                    <span>R$ {{ car.price|floatformat:2 }}</span>
                </div>
                <div class="installment-info">
                    ou em até <strong>48x de R$ {{ car.price|floatformat:2|add:"0"|floatformat:0 }}</strong>
                </div>
            </div>

            <!-- Especificações Rápidas -->
            <div class="quick-specs">
                <div class="spec-item">
                    <div class="spec-label">
                        <i class="fas fa-calendar"></i> Ano
                    </div>
                    <div class="spec-value">{{ car.factory_year }}/{{ car.model_year }}</div>
                </div>

                <div class="spec-item">
                    <div class="spec-label">
                        <i class="fas fa-palette"></i> Cor
                    </div>
                    <div class="spec-value">{{ car.color }}</div>
                </div>

                <div class="spec-item">
                    <div class="spec-label">
                        <i class="fas fa-tachometer-alt"></i> Km
                    </div>
                    <div class="spec-value">{{ car.mileage|floatformat:0 }} km</div>
                </div>

                <div class="spec-item">
                    <div class="spec-label">
                        <i class="fas fa-building"></i> Marca
                    </div>
                    <div class="spec-value">{{ car.brand.name }}</div>
                </div>
            </div>

            <!-- Botões de Ação -->
             {% if not user.is_staff %}
            <div class="action-buttons">
                {% if car.is_available %}
                    <a href="#" class="btn-action primary">
                        <i class="fab fa-whatsapp"></i>
                        Falar com Vendedor
                    </a>
                    <a href="#" class="btn-action secondary">
                        <i class="fas fa-calculator"></i>
                        Simular Financiamento
                    </a>
                    <a href="#" class="btn-action outline">
                        <i class="fas fa-calendar-check"></i>
                        Agendar Test Drive
                    </a>
                {% else %}
                    <button class="btn-action outline" disabled style="opacity: 0.5; cursor: not-allowed;">
                        <i class="fas fa-times-circle"></i>
                        Veículo Indisponível
                    </button>
                {% endif %}
                
            </div>
            {% endif %}

            <!-- Botões Administrativos (Apenas para Staff) -->
            {% if user.is_staff %}
            <div class="admin-actions">
                <div class="admin-actions-title">
                    <i class="fas fa-shield-alt"></i>
                    Ações Administrativas
                </div>
                <div class="admin-buttons">
                    <a href="{% url 'update_car' car.id %}" class="btn-action edit">
                        <i class="fas fa-edit"></i>
                        Editar
                    </a>
                    <button type="button" class="btn-action delete" id="deleteCarBtn">
                        <i class="fas fa-trash-alt"></i>
                        Deletar
                    </button>
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Especificações Detalhadas -->
    <div class="details-section">
        <h2 class="section-title">
            <i class="fas fa-info-circle"></i>
            Especificações Técnicas
        </h2>
        
        <div class="specs-grid">
            <div class="spec-detail">
                <div class="spec-icon">
                    <i class="fas fa-building"></i>
                </div>
                <div class="spec-content">
                    <strong>Marca</strong>
                    <span>{{ car.brand.name }}</span>
                </div>
            </div>

            <div class="spec-detail">
                <div class="spec-icon">
                    <i class="fas fa-car"></i>
                </div>
                <div class="spec-content">
                    <strong>Modelo</strong>
                    <span>{{ car.model }}</span>
                </div>
            </div>

            <div class="spec-detail">
                <div class="spec-icon">
                    <i class="fas fa-calendar-alt"></i>
                </div>
                <div class="spec-content">
                    <strong>Ano de Fabricação</strong>
                    <span>{{ car.factory_year }}</span>
                </div>
            </div>

            <div class="spec-detail">
                <div class="spec-icon">
                    <i class="fas fa-calendar-check"></i>
                </div>
                <div class="spec-content">
                    <strong>Ano do Modelo</strong>
                    <span>{{ car.model_year }}</span>
                </div>
            </div>

            <div class="spec-detail">
                <div class="spec-icon">
                    <i class="fas fa-palette"></i>
                </div>
                <div class="spec-content">
                    <strong>Cor</strong>
                    <span>{{ car.color }}</span>
                </div>
            </div>

            <div class="spec-detail">
                <div class="spec-icon">
                    <i class="fas fa-tachometer-alt"></i>
                </div>
                <div class="spec-content">
                    <strong>Quilometragem</strong>
                    <span>{{ car.mileage|floatformat:0 }} km</span>
                </div>
            </div>

            <div class="spec-detail">
                <div class="spec-icon">
                    <i class="fas fa-tag"></i>
                </div>
                <div class="spec-content">
                    <strong>Preço</strong>
                    <span>R$ {{ car.price|floatformat:2 }}</span>
                </div>
            </div>

            <div class="spec-detail">
                <div class="spec-icon">
                    <i class="fas fas fa-cog"></i>
                </div>
                <div class="spec-content">
                    <strong>Transmissão</strong>
                    <span>{{ car.transmission }}</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Descrição -->
    <div class="description-section">
        <h2 class="section-title">
            <i class="fas fa-file-alt"></i>
            Descrição do Veículo
        </h2>
        
        {% if car.description %}
            <p class="description-text">{{ car.description|linebreaks }}</p>
        {% else %}
            <p class="description-text empty">
                Este veículo ainda não possui uma descrição detalhada. Entre em contato conosco para mais informações!
            </p>
        {% endif %}
    </div>

    <!-- Seção de Contato -->
     {% if not user.is_staff %}
    <div class="contact-section">
        <h2><i class="fas fa-headset"></i> Interessado neste veículo?</h2>
        <p>Entre em contato com nossa equipe de vendas e agende uma visita!</p>
        
        <div class="contact-options">
            <a href="https://wa.me/5511123456789?text=Olá! Tenho interesse no {{ car.brand.name }} {{ car.model }} {{ car.model_year }}" 
               target="_blank" 
               class="contact-btn whatsapp">
                <i class="fab fa-whatsapp"></i>
                WhatsApp
            </a>
            <a href="tel:+5511123456789" class="contact-btn phone">
                <i class="fas fa-phone"></i>
                (11) 1234-5678
            </a>
        </div>
    </div>
    {% endif %}
</div>

<!-- Modal de Confirmação de Deleção -->
{% if user.is_staff %}
<div class="modal-overlay" id="deleteModal">
    <div class="modal-content">
        <div class="modal-header">
            <div class="modal-icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="modal-title">
                <h3>Confirmar Exclusão</h3>
                <p>Esta ação não poderá ser desfeita</p>
            </div>
        </div>
        
        <div class="modal-body">
            <div class="modal-car-info">
                <strong>{{ car.brand.name }} {{ car.model }}</strong>
                <p>Ano: {{ car.factory_year }}/{{ car.model_year }}</p>
                <p>Preço: R$ {{ car.price|floatformat:2 }}</p>
            </div>
            
            <div class="modal-warning">
                <i class="fas fa-info-circle"></i>
                <p>
                    <strong>Atenção!</strong> Ao confirmar, este veículo será permanentemente removido do sistema. 
                    Todas as informações e imagens associadas serão perdidas.
                </p>
            </div>
        </div>
        
        <div class="modal-actions">
            <button type="button" class="modal-btn cancel" id="cancelDeleteBtn">
                <i class="fas fa-times"></i>
                Cancelar
            </button>
            <form method="POST" action="{% url 'delete_car' car.id %}" style="margin: 0;">
                {% csrf_token %}
                <button type="submit" class="modal-btn confirm">
                    <i class="fas fa-trash-alt"></i>
                    Confirmar Exclusão
                </button>
            </form>
        </div>
    </div>
</div>
{% endif %}

{% endblock %}

{% block extra_js %}
<script>
    // ===== FUNCIONALIDADES DA GALERIA DE IMAGENS =====
    
    // Zoom na imagem principal
    const mainImage = document.getElementById('mainImage');
    const zoomBtn = document.getElementById('zoomBtn');
    
    if (mainImage && zoomBtn) {
        zoomBtn.addEventListener('click', function() {
            mainImage.classList.toggle('zoomed');
            const icon = this.querySelector('i');
            if (mainImage.classList.contains('zoomed')) {
                icon.className = 'fas fa-search-minus';
                this.title = 'Reduzir zoom';
            } else {
                icon.className = 'fas fa-search-plus';
                this.title = 'Ampliar imagem';
            }
        });
        
        // Clique na imagem também alterna o zoom
        mainImage.addEventListener('click', function(e) {
            if (!e.target.closest('.image-action-btn') && !e.target.closest('.image-overlay')) {
                mainImage.classList.toggle('zoomed');
                const icon = zoomBtn.querySelector('i');
                if (mainImage.classList.contains('zoomed')) {
                    icon.className = 'fas fa-search-minus';
                    zoomBtn.title = 'Reduzir zoom';
                } else {
                    icon.className = 'fas fa-search-plus';
                    zoomBtn.title = 'Ampliar imagem';
                }
            }
        });
    }
    
    // Lightbox (tela cheia)
    const fullscreenBtn = document.getElementById('fullscreenBtn');
    const lightboxModal = document.getElementById('lightboxModal');
    const closeLightbox = document.getElementById('closeLightbox');
    
    if (fullscreenBtn && lightboxModal) {
        fullscreenBtn.addEventListener('click', function() {
            lightboxModal.classList.add('active');
            document.body.style.overflow = 'hidden';
        });
        
        closeLightbox.addEventListener('click', function() {
            lightboxModal.classList.remove('active');
            document.body.style.overflow = '';
        });
        
        // Fechar com ESC
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && lightboxModal.classList.contains('active')) {
                lightboxModal.classList.remove('active');
                document.body.style.overflow = '';
            }
        });
        
        // Fechar clicando fora da imagem
        lightboxModal.addEventListener('click', function(e) {
            if (e.target === lightboxModal) {
                lightboxModal.classList.remove('active');
                document.body.style.overflow = '';
            }
        });
    }
    
    // Botão de compartilhar
    const shareBtn = document.getElementById('shareBtn');
    if (shareBtn) {
        shareBtn.addEventListener('click', async function() {
            const carTitle = '{{ car.brand.name }} {{ car.model }} {{ car.model_year }}';
            const carPrice = 'R$ {{ car.price|floatformat:2 }}';
            const shareText = `Confira este ${carTitle} por apenas ${carPrice} na NewCars!`;
            
            if (navigator.share) {
                try {
                    await navigator.share({
                        title: carTitle,
                        text: shareText,
                        url: window.location.href
                    });
                } catch (err) {
                    if (err.name !== 'AbortError') {
                        copyToClipboard();
                    }
                }
            } else {
                copyToClipboard();
            }
        });
        
        function copyToClipboard() {
            navigator.clipboard.writeText(window.location.href).then(() => {
                // Feedback visual
                const originalHTML = shareBtn.innerHTML;
                shareBtn.innerHTML = '<i class="fas fa-check"></i>';
                shareBtn.style.background = 'var(--primary-color)';
                
                setTimeout(() => {
                    shareBtn.innerHTML = originalHTML;
                    shareBtn.style.background = '';
                }, 2000);
            });
        }
    }
    
    // ===== ANIMAÇÕES E OBSERVADORES =====
    document.addEventListener('DOMContentLoaded', function() {
        const elements = document.querySelectorAll('.detail-grid, .details-section, .description-section, .contact-section');
        
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, {
            threshold: 0.1
        });

        elements.forEach(el => {
            observer.observe(el);
        });
        
        // Preload da imagem para lightbox
        const carImage = document.getElementById('carImage');
        if (carImage) {
            const img = new Image();
            img.src = carImage.src;
        }
    });
    
    // ===== MODAL DE CONFIRMAÇÃO DE DELEÇÃO =====
    const deleteBtn = document.getElementById('deleteCarBtn');
    const deleteModal = document.getElementById('deleteModal');
    const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
    
    if (deleteBtn && deleteModal) {
        // Abrir modal
        deleteBtn.addEventListener('click', function() {
            deleteModal.classList.add('active');
            document.body.style.overflow = 'hidden';
        });
        
        // Cancelar deleção
        cancelDeleteBtn.addEventListener('click', function() {
            deleteModal.classList.remove('active');
            document.body.style.overflow = '';
        });
        
        // Fechar com ESC
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && deleteModal.classList.contains('active')) {
                deleteModal.classList.remove('active');
                document.body.style.overflow = '';
            }
        });
        
        // Fechar clicando fora do modal
        deleteModal.addEventListener('click', function(e) {
            if (e.target === deleteModal) {
                deleteModal.classList.remove('active');
                document.body.style.overflow = '';
            }
        });
    }
</script>
{% endblock %}
